providers = ['node']
buildImage = 'ghcr.io/railwayapp/nixpacks:latest'

[phases.setup]
nixPkgs = ['...', 'python3', 'gcc']
onlyIncludeFiles = []

[phases.install]
cmds = [
    'npm install -g corepack@latest && corepack enable',
    'yarn install --mode=update-lockfile',
    'yarn install',
]
onlyIncludeFiles = [
    'package.json',
    '.yarnrc.yml',
    '.yarn',
    'apps/push/quorum/package.json',
    'libs/ts/db/package.json',
]

[phases.build]
cmds = ['yarn build-push-quorum']
onlyIncludeFiles = ['apps/push/quorum', 'libs/ts/db']

[variables]
PROPOSALS_BIN = 'push-quorum'

[start]
cmd = 'yarn start-push-quorum'
runImage = 'node:22-bookworm'
onlyIncludeFiles = [
    'apps/push/quorum',
    'libs/ts/db',
    'node_modules',
    'package.json',
    'yarn.lock',
    '.yarnrc.yml',
    '.yarn',
]
