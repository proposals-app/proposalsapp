providers = ['node']
buildImage = 'ghcr.io/railwayapp/nixpacks:latest'

[phases.setup]
nixPkgs = ['...', 'python3', 'gcc']
onlyIncludeFiles = []

[phases.install]
cmds = [
    'npm install -g corepack@latest && corepack enable',
    'yarn install --mode=update-lockfile',
    'yarn install',
]
onlyIncludeFiles = [
    'package.json',
    '.yarnrc.yml',
    '.yarn',
    'apps/web-arbitrum/package.json',
    'libs/ts/db/package.json',
    'libs/ts/emails/package.json',
]

[phases.build]
cmds = ['yarn build-web-arbitrum']
onlyIncludeFiles = ['apps/web-arbitrum', 'libs/ts/db', 'libs/ts/emails']

[variables]
PROPOSALS_BIN = 'web-arbitrum'

[start]
cmd = 'yarn start-web-arbitrum'
runImage = 'node:22-bookworm'
onlyIncludeFiles = [
    'apps/web-arbitrum',
    'libs/ts/db',
    'libs/ts/emails',
    'node_modules',
    'package.json',
    'yarn.lock',
    '.yarnrc.yml',
    '.yarn',
]
